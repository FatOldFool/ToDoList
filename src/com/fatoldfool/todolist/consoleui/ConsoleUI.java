package com.fatoldfool.todolist.consoleui;

import com.fatoldfool.todolist.taskservice.TaskService;

import java.util.Scanner;

public class ConsoleUI {

    private TaskService taskService;
    private Scanner userInput;

    public ConsoleUI() {
        taskService = new TaskService();
        userInput = new Scanner(System.in);
        run();
    }

    private void run() {

        while (true) {

            showMenu();

            String choice = requestMenuChoice();

            switch (choice) {
                case "1" -> taskService.addTask();
                case "2" -> {
                    if (taskService.getTask().isEmpty()) {
                        noTask();
                    } else {
                        int id = readInt("–í–≤–µ–¥–∏—Ç–µ ID –∑–∞–¥–∞—á–∏ –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è: ");
                        taskService.deleteTask(id);
                    }
                }
                case "3" -> {
                    if (taskService.getTask().isEmpty()) {
                        noTask();
                    } else {
                        int id = readInt("–í–≤–µ–¥–∏—Ç–µ ID –∑–∞–¥–∞—á–∏ –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è: ");
                        taskService.editTask(id);
                    }
                }
                case "4" -> {
                    if (taskService.getTask().isEmpty()) {
                        noTask();
                    } else {
                        int id = readInt("–í–≤–µ–¥–∏—Ç–µ ID –∑–∞–¥–∞—á–∏ –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è: ");
                        taskService.changeTaskStatus(id);
                    }
                }
                case "5" -> taskService.showAllTasks();
                case "6" -> taskService.filterTaskByStatus();
                case "7" -> taskService.findTaskByKeyWord();
                case "8" -> taskService.showStatistics();
                case "9" -> taskService.exit();
                default -> System.out.println("‚ùó –ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π –ø—É–Ω–∫—Ç.");
            }

            System.out.println("\n–ù–∞–∂–º–∏—Ç–µ <Enter> –¥–ª—è –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è...");
            new java.util.Scanner(System.in).nextLine();
        }
    }

    public void showMenu() {
        System.out.println("\n=== –ú–µ–Ω—é TodoList ===");
        System.out.println("1. –î–æ–±–∞–≤–∏—Ç—å –∑–∞–¥–∞—á—É");
        System.out.println("2. –£–¥–∞–ª–∏—Ç—å –∑–∞–¥–∞—á—É");
        System.out.println("3. –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∑–∞–¥–∞—á—É");
        System.out.println("4. –ò–∑–º–µ–Ω–∏—Ç—å —Å—Ç–∞—Ç—É—Å –∑–∞–¥–∞—á–∏");
        System.out.println("5. –ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ –∑–∞–¥–∞—á–∏");
        System.out.println("6. –§–∏–ª—å—Ç—Ä –ø–æ —Å—Ç–∞—Ç—É—Å—É");
        System.out.println("7. –ü–æ–∏—Å–∫ –∑–∞–¥–∞—á–∏ –ø–æ –∫–ª—é—á–µ–≤–æ–º—É —Å–ª–æ–≤—É");
        System.out.println("8. –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞");
        System.out.println("9. –í—ã—Ö–æ–¥");
    }

    private String requestMenuChoice() {
        System.out.println("–í—ã–±–µ—Ä–∏—Ç–µ –ø—É–Ω–∫—Ç –º–µ–Ω—é: ");
        String input = userInput.nextLine();
        return input;
    }

    private int readInt(String prompt) {
        while (true) {
            System.out.print(prompt);
            String line = new java.util.Scanner(System.in).nextLine().trim();
            try {
                int value = Integer.parseInt(line);
                if (value < 0) {
                    System.out.println("‚ùó –ß–∏—Å–ª–æ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–º.");
                } else {
                    return value;
                }
            } catch (NumberFormatException e) {
                System.out.println("‚ùó –í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ —á–∏—Å–ª–æ.");
            }
        }
    }

    private void noTask() {
        System.out.println("üì≠ –ù–µ—Ç —Å–æ–∑–¥–∞–Ω–Ω—ã—Ö –∑–∞–¥–∞—á. –î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–≤—É—é –∑–∞–¥–∞—á—É.");
    }
}
